<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PickleTurf</title>

<style>
:root{
--bg:#ffffff;--card:#f5f5f5;--accent:#F2C94C;--danger:#EF4444;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);padding:1rem}
.logo{text-align:center;margin-bottom:.5rem}
.logo img{width:160px}
nav{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
nav button{flex:1;background:#e5e7eb;border-radius:10px}
.card{background:var(--card);padding:1rem;border-radius:14px;margin-bottom:1rem}
input,select,button{width:100%;padding:.6rem;border-radius:10px;border:1px solid #d1d5db;margin:.25rem 0}
button{background:var(--accent);font-weight:700}
button.danger{background:var(--danger);color:#fff}
.flex{display:flex;gap:.5rem;flex-wrap:wrap}
.badge{padding:.2rem .6rem;border-radius:999px;font-size:.75rem}
.paid{background:#86efac}
.notpaid{background:#fde68a}
.hidden{display:none}
.player-item{padding:.3rem;cursor:pointer}
.player-item:hover{background:#e5e7eb}
.small{font-size:.75rem;color:#374151}
canvas{width:100%;max-height:240px}
</style>
</head>

<body>

<div class="logo"><img src="logo.png"></div>

<nav>
<button onclick="show('rentals')">Rentals</button>
<button onclick="show('unpaid')">Today's Unpaid</button>
<button onclick="show('summary')">Summary</button>
<button onclick="show('trend')">Trend</button>
<button onclick="show('players')">Players</button>
</nav>

<!-- RENTALS -->
<div id="rentals" class="card">
<h3>Add Rental</h3>

<label>Player</label>
<input id="player" placeholder="Type player name">
<div id="playerList"></div>

<label>Court</label>
<select id="court">
<option>Court 1</option><option>Court 2</option><option>Court 3</option>
<option>Court 4</option><option>Court 5</option>
</select>

<div class="flex">
<div style="flex:1">
<div class="small">Time In</div>
<input type="time" id="timeIn" required>
</div>
<div style="flex:1">
<div class="small">Time Out</div>
<input type="time" id="timeOut" required>
</div>
</div>

<label>Payment Method</label>
<select id="method">
<option>Cash</option>
<option>GCash</option>
</select>

<label>Coach Fee (optional)</label>
<input type="number" id="coachFee">

<label><input type="checkbox" id="paid"> Mark as Paid</label>

<button onclick="addRental()">Save Rental</button>

<hr>
<div id="rentalList"></div>
</div>

<!-- TODAY UNPAID -->
<div id="unpaid" class="card hidden">
<h3>Today's Unpaid Rentals</h3>
<div id="todayUnpaid"></div>
</div>

<!-- SUMMARY -->
<div id="summary" class="card hidden">
<h3>Summary</h3>
<select onchange="renderSummary(this.value)">
<option value="daily">Daily</option>
<option value="weekly">Weekly</option>
<option value="monthly">Monthly</option>
</select>
<div id="summaryData"></div>
</div>

<!-- TREND -->
<div id="trend" class="card hidden">
<h3>Monthly Income Trend</h3>
<canvas id="chart" height="220"></canvas>
</div>

<!-- PLAYERS -->
<div id="players" class="card hidden">
<h3>Players</h3>
<input id="searchPlayer" placeholder="Search player">
<div id="playerManageList"></div>
<hr>
<button class="danger" onclick="clearAll()">Clear All Data</button>
</div>

<script>
const KEY="pickleturf"
const load=()=>JSON.parse(localStorage.getItem(KEY))||[]
const save=d=>localStorage.setItem(KEY,JSON.stringify(d))

function show(id){
["rentals","unpaid","summary","trend","players"].forEach(x=>document.getElementById(x).classList.add("hidden"))
document.getElementById(id).classList.remove("hidden")
if(id==="trend") drawChart()
}

/* AUTOCOMPLETE (shared) */
function playerAuto(input, listEl){
input.addEventListener("input",()=>{
const v=input.value.toLowerCase()
listEl.innerHTML=""
[...new Set(load().map(r=>r.player))]
.filter(p=>p.toLowerCase().includes(v))
.forEach(p=>{
const d=document.createElement("div")
d.textContent=p; d.className="player-item"
d.onclick=()=>{input.value=p; listEl.innerHTML=""}
listEl.appendChild(d)
})
})
}
playerAuto(player,playerList)

/* ADD RENTAL */
function addRental(){
if(!player.value||!timeIn.value||!timeOut.value) return alert("Time In and Out required")

const d=load()
const s=new Date(), e=new Date()
const [h1,m1]=timeIn.value.split(":")
const [h2,m2]=timeOut.value.split(":")
s.setHours(h1,m1); e.setHours(h2,m2)

d.push({
id:Date.now(),player:player.value,court:court.value,
method:method.value,coachFee:+coachFee.value||0,
paid:paid.checked,timeIn:s.toISOString(),timeOut:e.toISOString()
})
save(d)
player.value=""; timeIn.value=""; timeOut.value=""; coachFee.value=""; paid.checked=false
render()
}

/* FEE CALC */
function fee(r){
const s=new Date(r.timeIn), e=new Date(r.timeOut)
const mins=(e-s)/60000
let total=Math.ceil(mins/30)*50
let t=new Date(s)
while(t<e){ if(t.getHours()>=18) total+=20; t.setHours(t.getHours()+1) }
return total+(r.coachFee||0)
}

/* DELETE */
function deleteRental(id){
if(confirm("Delete this rental?")){
save(load().filter(r=>r.id!==id))
render()
}
}

/* MARK PAID */
function markPaid(id){
const d=load(); d.find(r=>r.id===id).paid=true; save(d); render()
}

/* RENDER */
function render(){
rentalList.innerHTML=""; todayUnpaid.innerHTML=""
const today=new Date().toDateString()

load().forEach(r=>{
rentalList.innerHTML+=`
<div>
<strong>${r.player}</strong> | ${r.court} | ‚Ç±${fee(r)}
<span class="badge ${r.paid?'paid':'notpaid'}">${r.paid?'Paid':'Unpaid'}</span>
<div class="flex">
${!r.paid?`<button onclick="markPaid(${r.id})">Mark Paid</button>`:""}
<button class="danger" onclick="deleteRental(${r.id})">Delete</button>
</div>
</div><hr>`

if(!r.paid && new Date(r.timeIn).toDateString()===today){
todayUnpaid.innerHTML+=`
<div class="flex">
<div>${r.player}<br>${r.court} | ‚Ç±${fee(r)}</div>
<div class="flex">
<button onclick="markPaid(${r.id})">Paid</button>
<button class="danger" onclick="deleteRental(${r.id})">Delete</button>
</div>
</div><hr>`
}
})
if(!todayUnpaid.innerHTML) todayUnpaid.innerHTML="None üéâ"
}

/* SUMMARY */
function renderSummary(type){
let start=new Date()
if(type==="weekly") start.setDate(start.getDate()-7)
if(type==="monthly") start.setMonth(start.getMonth()-1)
let t=0,p=0
load().forEach(r=>{
if(!r.timeOut) return
const d=new Date(r.timeIn)
if(type==="daily"&&d.toDateString()!==new Date().toDateString())return
if(type!=="daily"&&d<start)return
const f=fee(r); t+=f; if(r.paid)p+=f
})
summaryData.innerHTML=`Total ‚Ç±${t}<br>Paid ‚Ç±${p}<br>Unpaid ‚Ç±${t-p}`
}

/* TREND */
function drawChart(){
const ctx=chart.getContext("2d")
ctx.clearRect(0,0,chart.width,chart.height)
const m={}
load().forEach(r=>{
if(!r.timeOut) return
const k=new Date(r.timeIn).toLocaleString("default",{month:"short"})
m[k]=(m[k]||0)+fee(r)
})
const keys=Object.keys(m).slice(-6)
const max=Math.max(...Object.values(m),1)
keys.forEach((k,i)=>{
const h=m[k]/max*150, x=40+i*50
ctx.fillStyle="#F2C94C"
ctx.fillRect(x,180-h,30,h)
ctx.fillStyle="#000"
ctx.fillText(`‚Ç±${m[k]}`,x-5,170-h)
ctx.fillText(k,x,200)
})
}

/* PLAYERS */
playerAuto(searchPlayer,playerManageList)

function clearAll(){
if(confirm("‚ö†Ô∏è This will delete ALL data. Continue?")){
localStorage.removeItem(KEY); render()
}
}

render()
</script>
</body>
</html>
